max_warnings 2

expressions
#  debug typecast
#  show_shp yes
  read -

float h_a[4],h_b[4],h_c[4];
end
  quit


platforms
  select $DEFAULT_PLATFORM $DEFAULT_GPU
  quit

expressions
  read -

float a[4],b[4],c[4];

a=ramp(0,1,0);
b=ramp(0,10,0);
c=ramp(10,1,0);

print("declaring testk...");

void testk(float *dest, float *src1, float *src2, float kkk)
{
	float k2;
#	int ix;	# genreates int32?
	short ix;

	k2=atan2(kkk,1);
	ix = round(kkk) << 2;
#	*dest = k2 + *src1 + kkk * (*src2+2);

	*dest = *src1 > 5 ? *src2 : 66 ;
}

end
  #dump testk
  #Pause
  quit

VSet h_a -5
advise "Running subroutine on host..."
expressions run testk h_a h_b h_c 5.1 quit
Display h_a


VSet a -5
advise "Running standard kernel..."
expressions run testk a b c 5.1 quit
Display a

advise "Running fused kernel..."
VSet a -5
expressions
  fuse testk
#  info testk
#  debug resolver
  run testk a b c 5.1
  quit
Display a

  quit

exit


